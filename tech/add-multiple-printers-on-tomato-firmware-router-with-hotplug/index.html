<!DOCTYPE html><html class="has-navbar-fixed-top"><head><meta charset="utf-8"><title>Add multiple printers on Tomato firmware router with hotplug - Qualityology - Let&#39;s get the most out of life!</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Tomato firmware in default only recognize one printer. If more printers are detected, it assign the first detected printer to lp0. When a printer is plugged into the Tomato router and turned on, the p"><meta property="og:type" content="article"><meta property="og:title" content="Add multiple printers on Tomato firmware router with hotplug"><meta property="og:url" content="https://www.qualityology.com/tech/add-multiple-printers-on-tomato-firmware-router-with-hotplug/index.html"><meta property="og:site_name" content="Qualityology - Let&#39;s get the most out of life!"><meta property="og:description" content="Tomato firmware in default only recognize one printer. If more printers are detected, it assign the first detected printer to lp0. When a printer is plugged into the Tomato router and turned on, the p"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.qualityology.com/2014/07/tomato-printers.png"><meta property="article:published_time" content="2014-07-14T17:25:08.000Z"><meta property="article:modified_time" content="2021-02-22T23:03:12.007Z"><meta property="article:author" content="Evan Xu"><meta property="article:tag" content="printers"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.qualityology.com/2014/07/tomato-printers.png"><link rel="alternative" href="/rss.xml" title="Add multiple printers on Tomato firmware router with hotplug" type="aapplication/rss+xml"><link rel="alternative" href="/atom.xml" title="Add multiple printers on Tomato firmware router with hotplug" type="application/atom+xml"><link rel="alternative" href="/feed.json" title="Add multiple printers on Tomato firmware router with hotplug" type="application/json"><link rel="icon" type="image/png" href="/assets/logo.png"><link rel="apple-touch-icon" href="/assets/logo_160.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/logo_304.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/logo_360.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/logo_334.png"><meta name="apple-mobile-web-app-title" content="Add multiple printers on Tomato firmware router with hotplug - Qualityology - Let&#39;s get the most out of life!"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.9.2/css/bulma.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css"><link rel="stylesheet" href="/css/style.css"><script defer src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/js/all.min.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>const pageLoaded=()=>{const o=window.adsbygoogle||[];o.push({}),o.push({})}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-6144848-7"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-6144848-7")</script><meta name="generator" content="Hexo 5.4.0"></head><body onload="pageLoaded()"><nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item navbar-logo" href="/"><img src="/assets/loading.gif" data-original="/assets/logo.png" alt height="28"></a><div class="navbar-burger"><span></span> <span></span> <span></span></div></div><div class="navbar-menu navbar-start"><span class="navbar-item"><a href="/lifestyle">Lifestyle </a></span><span class="navbar-item is-active"><a href="/tech">Technology</a></span></div><div class="navbar-menu navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></nav><section class="section"><div class="container"><article class="article content gallery" itemscope itemprop="blogPost"><h1 class="article-title is-size-4 is-size-4-mobile" itemprop="name">Add multiple printers on Tomato firmware router with hotplug</h1><div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile"><span class="column is-narrow"><time datetime="2014-07-14T17:25:08.000Z" itemprop="datePublished">Jul 14 2014</time> </span><span class="column is-narrow article-category"><i class="far fa-folder"></i> <a class="article-category-link" href="/tech/">tech</a> </span><span class="column is-narrow">4 minutes read (About 559 words)</span></div><div class="article-entry is-size-6-mobile" itemprop="articleBody"><p>Tomato firmware in default only recognize one printer. If more printers are detected, it assign the first detected printer to lp0. When a printer is plugged into the Tomato router and turned on, the printer port is assigned.</p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6914615778368190" data-ad-slot="9746105168" data-ad-format="auto" data-full-width-responsive="true"></ins><p>To add a second p910nd instance, you need to manually run it with p910nd -f /dev/usb/lp1 1, and add -b for bidirectional if needed. When sharing one printer using p910nd in Tomato firmware, the first printer will be assigned to default port 9100. If you plug in more than one printers, the usb printer kernel module assigns /dev/usb/lp devices in the order printers are turned on/off. When a printer is turned on and recognized on the usb bus, it receives the first free device name in /dev/usb/lp.</p><p>If you are using more than one printers and turn them on and off all the time, you have to change device assignments for p910nd dynamically. The following configuration uses the Hotplug script to pair printers to designed ports. This allows multiple printers to be recognized, assigned ports based on the product ID, same ports assigned will resume when printers are connected/turned on. Works on both usb printer and parallel printer using serial to USB adapter.</p><h2 id="Step-1-Turn-on-&#x201C;Core-USB-Support&#x201D;-&#x201C;USB-2-0-Support&#x201D;-&#x201C;USB-1-1-Support-Optional-&#x201D;-&#x201C;USB-Printer-Support&#x201D;-and-&#x201C;USB-Storage-Support&#x201D;-under-&#x201C;USB-Support&#x201D;"><a href="#Step-1-Turn-on-&#x201C;Core-USB-Support&#x201D;-&#x201C;USB-2-0-Support&#x201D;-&#x201C;USB-1-1-Support-Optional-&#x201D;-&#x201C;USB-Printer-Support&#x201D;-and-&#x201C;USB-Storage-Support&#x201D;-under-&#x201C;USB-Support&#x201D;" class="headerlink" title="Step 1: Turn on &#x201C;Core USB Support&#x201D;, &#x201C;USB 2.0 Support&#x201D;, &#x201C;USB 1.1 Support (Optional)&#x201D;, &#x201C;USB Printer Support&#x201D;, and &#x201C;USB Storage Support&#x201D; under &#x201C;USB Support&#x201D;."></a>Step 1: Turn on &#x201C;Core USB Support&#x201D;, &#x201C;USB 2.0 Support&#x201D;, &#x201C;USB 1.1 Support (Optional)&#x201D;, &#x201C;USB Printer Support&#x201D;, and &#x201C;USB Storage Support&#x201D; under &#x201C;USB Support&#x201D;.</h2><h2 id="Step2-Unplug-all-printers-Copy-and-paste-the-following-code-into-the-&#x201C;Hotplug-script&#x201D;-box"><a href="#Step2-Unplug-all-printers-Copy-and-paste-the-following-code-into-the-&#x201C;Hotplug-script&#x201D;-box" class="headerlink" title="Step2: Unplug all printers. Copy and paste the following code into the &#x201C;Hotplug script&#x201D; box."></a>Step2: Unplug all printers. Copy and paste the following code into the &#x201C;Hotplug script&#x201D; box.</h2><p>The following code is a demo of sharing three printers.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line"># log printers Interface, VID, and PID information</span><br><span class="line">echo Product:${PRODUCT} Interface: ${INTERFACE}&gt;&gt; /var/log/hotplug</span><br><span class="line"></span><br><span class="line"># process printers only</span><br><span class="line"># usb port</span><br><span class="line"># parallel to usb port</span><br><span class="line">if [ &quot;$INTERFACE&quot; = &quot;7/1/1&quot; ]  [ &quot;$INTERFACE&quot; = &quot;7/1/2&quot; ]</span><br><span class="line">then</span><br><span class="line"></span><br><span class="line"># set -x</span><br><span class="line">DEV=&quot;none&quot;</span><br><span class="line"></span><br><span class="line"># Printer_1</span><br><span class="line"></span><br><span class="line">if [ &quot;$PRODUCT&quot; = &quot;4f9/33/100&quot; ]</span><br><span class="line">        then</span><br><span class="line">                VID=&quot;04f9&quot;</span><br><span class="line">                PID=&quot;0033&quot;</span><br><span class="line">                DEV=&quot;Printer_1&quot;</span><br><span class="line">                port=&quot;0&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line"># Printer_2</span><br><span class="line"></span><br><span class="line">if [ &quot;$PRODUCT&quot; = &quot;1645/6/100&quot; ]</span><br><span class="line">        then</span><br><span class="line">                VID=&quot;1645&quot;</span><br><span class="line">                PID=&quot;0006&quot;</span><br><span class="line">                DEV=&quot;Printer_2&quot;</span><br><span class="line">                port=&quot;1&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line"># Printer_3</span><br><span class="line"></span><br><span class="line">if [ &quot;$PRODUCT&quot; = &quot;4f9/2028/100&quot; ]</span><br><span class="line">        then</span><br><span class="line">                VID=&quot;04f9&quot;</span><br><span class="line">                PID=&quot;2028&quot;</span><br><span class="line">                DEV=&quot;Printer_3&quot;</span><br><span class="line">                port=&quot;2&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">if [ &quot;$DEV&quot; != &quot;none&quot; ]</span><br><span class="line">then</span><br><span class="line">if [ -n &quot;$port&quot; ]; then</span><br><span class="line">for pid in `ps  grep -i p910${port}d  grep -v grep  cut -c1-5` ; do</span><br><span class="line">kill -9 $pid</span><br><span class="line">done</span><br><span class="line">if [ &quot;$ACTION&quot; = &quot;add&quot; ]</span><br><span class="line">then</span><br><span class="line"># search for last printer assignment in syslog (/var/log/syslog.log or logread)</span><br><span class="line"></span><br><span class="line">LP=`dmesg  grep -i &quot;usblp.: USB Bidirectional printer dev .* if .* alt .* proto .* vid 0x$VID pid 0x$PID&quot;  grep -io &quot;lp[0-9]&quot;  tail -n 1`</span><br><span class="line"></span><br><span class="line">if [ &quot;$LP&quot; != &quot;&quot; ]</span><br><span class="line">then</span><br><span class="line">echo $LP &gt;/var/run/$DEV.lp</span><br><span class="line">ln -s /dev/usb/$LP /dev/$DEV</span><br><span class="line">p910nd -b -f /dev/$DEV $port</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">if [ &quot;$ACTION&quot; = &quot;remove&quot; ]</span><br><span class="line">then</span><br><span class="line"># LP = `cat /var/run/$DEV.lp`</span><br><span class="line">rm /var/run/$DEV.lp</span><br><span class="line">rm /dev/$DEV</span><br><span class="line"></span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p><img src="/assets/loading.gif" data-original="/2014/07/tomato-printers.png" alt="Tomato Printers"> Tomato Printers</p><h2 id="Step-3-plug-each-printer-one-by-one-into-the-router-check-&#x201C;-var-log-hotplug&#x201D;-copy-and-paste-printers&#x2019;-PRODUCT-VID-and-PID-information-into-the-hotplug-code-above"><a href="#Step-3-plug-each-printer-one-by-one-into-the-router-check-&#x201C;-var-log-hotplug&#x201D;-copy-and-paste-printers&#x2019;-PRODUCT-VID-and-PID-information-into-the-hotplug-code-above" class="headerlink" title="Step 3: plug each printer one by one into the router, check &#x201C;/var/log/hotplug&#x201D;, copy and paste printers&#x2019; PRODUCT, VID, and PID information into the hotplug code above."></a>Step 3: plug each printer one by one into the router, check &#x201C;/var/log/hotplug&#x201D;, copy and paste printers&#x2019; PRODUCT, VID, and PID information into the hotplug code above.</h2><h2 id="Step-4-Turn-off-&#x201C;USB-Printer-Support&#x201D;-this-will-disable-the-default-printer-support-and-port-assignation"><a href="#Step-4-Turn-off-&#x201C;USB-Printer-Support&#x201D;-this-will-disable-the-default-printer-support-and-port-assignation" class="headerlink" title="Step 4: Turn off &#x201C;USB Printer Support&#x201D;, this will disable the default printer support and port assignation."></a>Step 4: Turn off &#x201C;USB Printer Support&#x201D;, this will disable the default printer support and port assignation.</h2><h2 id="Step-5-Copy-and-paste-the-following-code-into-&#x201C;init&#x201D;-under-&#x201C;Administration&#x201D;-&#x201C;Scripts&#x201D;"><a href="#Step-5-Copy-and-paste-the-following-code-into-&#x201C;init&#x201D;-under-&#x201C;Administration&#x201D;-&#x201C;Scripts&#x201D;" class="headerlink" title="Step 5: Copy and paste the following code into &#x201C;init&#x201D; under &#x201C;Administration&#x201D; &#x201C;Scripts&#x201D;"></a>Step 5: Copy and paste the following code into &#x201C;init&#x201D; under &#x201C;Administration&#x201D; &#x201C;Scripts&#x201D;</h2><p>This will load the printer support when the router start.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe usblp</span><br></pre></td></tr></table></figure><h2 id="Step-6-This-is-it-Reboot-and-test"><a href="#Step-6-This-is-it-Reboot-and-test" class="headerlink" title="Step 6: This is it. Reboot and test"></a>Step 6: This is it. Reboot and test</h2><p><strong>Note: Hotplug script box needs &#x201C;USB Storage Support&#x201D; be turned on at least.</strong> If you don&#x2019;t want USB Storage Support, you can turn it off by using the code into &#x201C;init&#x201D; under &#x201C;Administration&#x201D; &#x201C;Scripts&#x201D;.</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe -r usb_storage</span><br></pre></td></tr></table></figure><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6914615778368190" data-ad-slot="2953513567" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div class="columns is-variable is-1 is-multiline is-mobile"><span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/printers/">#printers</a></span></div><div class="columns is-mobile is-multiline article-nav"><span class="column is-12-mobile is-half-desktop article-nav-prev"><a href="/tech/installing-the-cups-print-server-to-pfsense-2-1-and-2-x/">Installing the CUPS Print Server to pfSense 2.1 and 2.x</a> </span><span class="column is-12-mobile is-half-desktop article-nav-next"><a href="/tech/changing-default-date-and-timezones-on-a-linux-server/">Changing default date and timezones on a Linux server</a></span></div></article><div class="sharebox"><div class="sharethis-inline-share-buttons"></div><script async type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=6030430e289b2f0011212bb6&amp;product=sop"></script></div><div class="comments"><h3 class="title is-4">Comments</h3><div id="isso-thread" data-title="Add multiple printers on Tomato firmware router with hotplug"></div><script async data-isso="//comments.qualityology.com" src="//comments.qualityology.com/js/embed.min.js" data-isso-require-author="true" data-isso-require-email="true" data-isso-avatar="false" data-isso-gravatar="true" data-isso-vote="true" data-isso-reveal-on-click="true"></script></div></div></section><footer class="footer"><div class="container"><div class="columns content"><div class="column is-narrow has-text-centered">&copy; 2021 Qualityology&nbsp;</div><div class="column is-hidden-mobile"></div></div></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script>window.FontAwesomeConfig={searchPseudoElements:!0},moment.locale("en-AU")</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><style>.hljs{position:relative}.hljs .clipboard-btn{float:right;color:#9a9a9a;background:0 0;border:none;cursor:pointer}.hljs .clipboard-btn:hover{color:#8a8a8a}.hljs>.clipboard-btn{display:none;position:absolute;right:4px;top:4px}.hljs:hover>.clipboard-btn{display:inline}.hljs>figcaption>.clipboard-btn{margin-right:4px}</style><script>$(document).ready(function(){$("figure.hljs").each(function(t,e){var a="code-"+t,r=e.querySelector(".code"),t=$('<button>Copy <i class="far fa-clipboard"></i></button>');r.id=a,t.addClass("clipboard-btn"),t.attr("data-clipboard-target-id",a);a=e.querySelector("figcaption");a?a.append(t[0]):e.prepend(t[0])}),new ClipboardJS(".clipboard-btn",{target:function(t){return document.getElementById(t.getAttribute("data-clipboard-target-id"))}}).on("success",function(t){t.clearSelection()})})</script><script src="/js/script.js"></script><div class="searchbox ins-search"><div class="searchbox-mask"></div><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 3,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>