<!DOCTYPE html><html class="has-navbar-fixed-top"><head><meta charset="utf-8"><title>Easy Dual WAN Load Balancing with MikroTik RouterOS PCC - Qualityology - Let&#39;s get the most out of life!</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="preconnect" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="preconnect" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="preconnect" href="//ajax.googleapis.com"><link rel="dns-prefetch" href="//ajax.googleapis.com"><link rel="canonical" href="https://www.qualityology.com/tech/easy-dual-wan-load-balancing-with-mikrotik-routeros-pcc/"><meta name="description" content="RouterOS&amp;#x2019;s load balancing is simple but tricky. Even Mikrotik shows an example of how to configure PCC for load balancing. It does not say how to implement it with dynamic IP. The method introd"><meta property="og:type" content="article"><meta property="og:title" content="Easy Dual WAN Load Balancing with MikroTik RouterOS PCC"><meta property="og:url" content="https://www.qualityology.com/tech/easy-dual-wan-load-balancing-with-mikrotik-routeros-pcc/index.html"><meta property="og:site_name" content="Qualityology - Let&#39;s get the most out of life!"><meta property="og:description" content="RouterOS&amp;#x2019;s load balancing is simple but tricky. Even Mikrotik shows an example of how to configure PCC for load balancing. It does not say how to implement it with dynamic IP. The method introd"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2019-02-14T22:39:03.000Z"><meta property="article:modified_time" content="2021-02-20T03:07:33.546Z"><meta property="article:author" content="Evan Xu"><meta property="article:tag" content="Mikrotik"><meta property="article:tag" content="PCC"><meta name="twitter:card" content="summary"><link rel="icon" type="image/png" href="/assets/logo.png"><link rel="apple-touch-icon" href="/assets/logo_160.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/logo_304.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/logo_360.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/logo_334.png"><meta name="apple-mobile-web-app-title" content="Easy Dual WAN Load Balancing with MikroTik RouterOS PCC - Qualityology - Let&#39;s get the most out of life!"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.9.2/css/bulma.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto&display=swap"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css"><link rel="stylesheet" href="/css/style.css"><script>const pageLoaded=()=>{const o=window.adsbygoogle||[];o.push({}),o.push({})}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-6144848-7"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-6144848-7")</script><meta name="generator" content="Hexo 5.4.0"></head><body onload="pageLoaded()"><nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item navbar-logo" href="/"><img src="/assets/loading.gif" data-original="/assets/logo.png" alt height="28"></a><div class="navbar-burger"><span></span> <span></span> <span></span></div></div><div class="navbar-menu navbar-start"><span class="navbar-item"><a href="/lifestyle">Lifestyle </a></span><span class="navbar-item is-active"><a href="/tech">Technology</a></span></div><div class="navbar-menu navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></nav><section class="section"><div class="container"><article class="article content gallery" itemscope itemprop="blogPost"><h1 class="article-title is-size-4 is-size-4-mobile" itemprop="name">Easy Dual WAN Load Balancing with MikroTik RouterOS PCC</h1><div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile"><span class="column is-narrow"><time datetime="2019-02-14T22:39:03.000Z" itemprop="datePublished">Feb 14 2019</time> </span><span class="column is-narrow article-category"><i class="far fa-folder"></i> <a class="article-category-link" href="/tech/">tech</a> </span><span class="column is-narrow">5 minutes read (About 799 words)</span></div><div class="article-entry is-size-6-mobile" itemprop="articleBody"><p>RouterOS&#x2019;s load balancing is simple but tricky. Even Mikrotik shows an example of how to configure PCC for load balancing. It does not say how to implement it with dynamic IP. The method introduced here is simple. We will add lease scripts to WAN1 and WAN2. RouterOS will run the script to add the correct gateway IP and firewall rules to make the load balancing work.</p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6914615778368190" data-ad-slot="9746105168" data-ad-format="auto" data-full-width-responsive="true"></ins><p><strong>Requirements:</strong></p><p>1. Name your WAN ports as WAN1 and WAN2. Your bridge as bridge.<br>2. Basic knowledge of RouterOS<br>3. Turn off fasttrack. Yes. It must be off. Otherwise, router can&#x2019;t mark traffic and distribute to both WANs. Disable the firewall filter with action &#x201C;fasttrack-connection&#x201D; and that is it.</p><p>Add below scripts to&#xA0;IP/DHCP Client/WAN1 and&#xA0;IP/DHCP Client/WAN2. You can do that via web config.</p><p><strong>For WAN1:</strong></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">{</span><br><span class="line">    :local count [/ip route print count-only where comment=WAN1]</span><br><span class="line">    :if ($bound=1) do={</span><br><span class="line">        :if ($count = 0) do={</span><br><span class="line">            /ip route add gateway=$&quot;gateway-address&quot; routing-mark=WAN1 comment=WAN1</span><br><span class="line">            /ip firewall nat add chain=srcnat out-interface=WAN1 action=masquerade comment=WAN1</span><br><span class="line">            /ip firewall mangle add chain=prerouting dst-address=$&quot;gateway-address&quot; action=accept in-interface=bridge comment=WAN1</span><br><span class="line">            /ip route add gateway=$&quot;gateway-address&quot; routing-mark=WAN1_out check-gateway=ping comment=WAN1</span><br><span class="line">            /ip route add gateway=$&quot;gateway-address&quot; distance=1 check-gateway=ping comment=WAN1</span><br><span class="line">        } else={</span><br><span class="line">            :if ($count &gt; 1) do={</span><br><span class="line">                :local test [/ip route find where comment=WAN1]</span><br><span class="line">                :if ([/ip route get $test gateway] != $&quot;gateway-address&quot;) do={</span><br><span class="line">                    /ip route set $test gateway=$&quot;gateway-address&quot;</span><br><span class="line">                }</span><br><span class="line">               :local test2 [/ip firewall mangle find where comment=WAN1]</span><br><span class="line">                :if ([/ip firewall mangle get $test2 gateway] != $&quot;gateway-address&quot;) do={</span><br><span class="line">                    /ip route set $test2 gateway=$&quot;gateway-address&quot;</span><br><span class="line">                }</span><br><span class="line">            } else={</span><br><span class="line">                :error &quot;Multiple routes found&quot;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } else={</span><br><span class="line">        /ip route remove [find comment=WAN1]</span><br><span class="line">        /ip firewall mangle remove [find comment=WAN1]</span><br><span class="line">        /ip firewall nat remove [find comment=WAN1]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><strong>For WAN2:</strong></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    :local count [/ip route print count-only where comment=WAN2]</span><br><span class="line">    :if ($bound=1) do={</span><br><span class="line">        :if ($count = 0) do={</span><br><span class="line">            /ip route add gateway=$&quot;gateway-address&quot; routing-mark=WAN2 comment=WAN2</span><br><span class="line">            /ip firewall nat add chain=srcnat out-interface=WAN2 action=masquerade comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting dst-address=$&quot;gateway-address&quot; action=accept in-interface=bridge comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting in-interface=WAN1 connection-mark=no-mark action=mark-connection new-connection-mark=WAN1_conn comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting in-interface=WAN2 connection-mark=no-mark action=mark-connection new-connection-mark=WAN2_conn comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting in-interface=bridge connection-mark=no-mark dst-address-type=!local protocol=tcp dst-port=22,80,443  per-connection-classifier=both-addresses:2/0 action=mark-connection new-connection-mark=WAN1_conn comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting in-interface=bridge connection-mark=no-mark dst-address-type=!local protocol=tcp dst-port=22,80,443  per-connection-classifier=both-addresses:2/1 action=mark-connection new-connection-mark=WAN2_conn comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting in-interface=bridge connection-mark=no-mark dst-address-type=!local per-connection-classifier=both-addresses-and-ports:2/0 action=mark-connection new-connection-mark=WAN1_conn comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting in-interface=bridge connection-mark=no-mark dst-address-type=!local per-connection-classifier=both-addresses-and-ports:2/1 action=mark-connection new-connection-mark=WAN2_conn comment=WAN2            </span><br><span class="line">            /ip firewall mangle add chain=prerouting connection-mark=WAN1_conn in-interface=bridge action=mark-routing new-routing-mark=WAN1_out comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=prerouting connection-mark=WAN2_conn in-interface=bridge action=mark-routing new-routing-mark=WAN2_out comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=output connection-mark=WAN1_conn action=mark-routing new-routing-mark=WAN1_out comment=WAN2</span><br><span class="line">            /ip firewall mangle add chain=output connection-mark=WAN2_conn action=mark-routing new-routing-mark=WAN2_out comment=WAN2</span><br><span class="line">            /ip route add gateway=$&quot;gateway-address&quot; routing-mark=WAN2_out check-gateway=ping comment=WAN2</span><br><span class="line">            /ip route add gateway=$&quot;gateway-address&quot; distance=2 check-gateway=ping comment=WAN2</span><br><span class="line">        } else={</span><br><span class="line">            :if ($count &gt; 1) do={</span><br><span class="line">                :local test [/ip route find where comment=WAN2]</span><br><span class="line">                :if ([/ip route get $test gateway] != $&quot;gateway-address&quot;) do={</span><br><span class="line">                    /ip route set $test gateway=$&quot;gateway-address&quot;</span><br><span class="line">                }</span><br><span class="line">               :local test2 [/ip firewall mangle find where comment=WAN2]</span><br><span class="line">                :if ([/ip firewall mangle get $test2 gateway] != $&quot;gateway-address&quot;) do={</span><br><span class="line">                    /ip route set $test2 gateway=$&quot;gateway-address&quot;</span><br><span class="line">                }</span><br><span class="line">            } else={</span><br><span class="line">                :error &quot;Multiple routes found&quot;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    } else={</span><br><span class="line">        /ip route remove [find comment=WAN2]</span><br><span class="line">        /ip firewall mangle remove [find comment=WAN2]</span><br><span class="line">        /ip firewall nat remove [find comment=WAN2]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>For port 22,80,443 we use &#x201C;both-addresses&#x201D; as connection classifier to avoid HTTPS error or other authentication issues. Other ports we use both-addresses-and-ports so we can get maximum speed from both WANs.</p><p>If you want to see the official doc of how to configure PCC in RouterOS. Here is the link: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://wiki.mikrotik.com/wiki/Manual:PCC">https://wiki.mikrotik.com/wiki/Manual:PCC</a></p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6914615778368190" data-ad-slot="2953513567" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div class="columns is-variable is-1 is-multiline is-mobile"><span class="column is-narrow"><a class="tag is-light article-tag" href="/tag/mikrotik/">#Mikrotik</a></span> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tag/pcc/">#PCC</a></span></div><div class="columns is-mobile is-multiline article-nav"><span class="column is-12-mobile is-half-desktop article-nav-prev"><a href="/tech/29-code-snippets-for-wordpress-users/">29 Code Snippets for WordPress Users</a> </span><span class="column is-12-mobile is-half-desktop article-nav-next"><a href="/tech/set-custom-dns-server-on-linux-resolv-conf/">Set custom DNS servers on Linux with resolv.conf</a></span></div></article><div class="sharebox"><div class="sharethis-inline-share-buttons"></div><script async type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=6030430e289b2f0011212bb6&amp;product=sop"></script></div><div class="comments"><h3 class="title is-4">Comments</h3><div id="isso-thread" data-title="Easy Dual WAN Load Balancing with MikroTik RouterOS PCC"></div><script async data-isso="//comments.qualityology.com" src="//comments.qualityology.com/js/embed.min.js" data-isso-require-author="true" data-isso-require-email="true" data-isso-avatar="false" data-isso-gravatar="true" data-isso-vote="true" data-isso-reveal-on-click="true"></script></div></div></section><footer class="footer"><div class="container"><div class="columns content"><div class="column is-narrow has-text-centered">&copy; 2021 Qualityology&nbsp;</div><div class="column is-hidden-mobile"></div></div></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/js/all.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>window.FontAwesomeConfig={searchPseudoElements:!0},moment.locale("en-AU")</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><style>.hljs{position:relative}.hljs .clipboard-btn{float:right;color:#9a9a9a;background:0 0;border:none;cursor:pointer}.hljs .clipboard-btn:hover{color:#8a8a8a}.hljs>.clipboard-btn{display:none;position:absolute;right:4px;top:4px}.hljs:hover>.clipboard-btn{display:inline}.hljs>figcaption>.clipboard-btn{margin-right:4px}</style><script>$(document).ready(function(){$("figure.hljs").each(function(t,e){var a="code-"+t,r=e.querySelector(".code"),t=$('<button>Copy <i class="far fa-clipboard"></i></button>');r.id=a,t.addClass("clipboard-btn"),t.attr("data-clipboard-target-id",a);a=e.querySelector("figcaption");a?a.append(t[0]):e.prepend(t[0])}),new ClipboardJS(".clipboard-btn",{target:function(t){return document.getElementById(t.getAttribute("data-clipboard-target-id"))}}).on("success",function(t){t.clearSelection()})})</script><script src="/js/script.js"></script><div class="searchbox ins-search"><div class="searchbox-mask"></div><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 3,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>