<!DOCTYPE html><html class="has-navbar-fixed-top"><head><meta charset="utf-8"><title>Protect your WordPress from Automated Comment Spam and Brute Force Login Attack - Qualityology - Let&#39;s get the most out of life!</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="preconnect" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="preconnect" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="preconnect" href="//ajax.googleapis.com"><link rel="dns-prefetch" href="//ajax.googleapis.com"><link rel="canonical" href="https://www.qualityology.com/tech/stop-automated-comment-spam-brute-force-login-attack/"><meta name="description" content="Is your WordPress flooded with spam comment or being attacked by brute force login attempt? Thinking about spam blocking plugin? There are a lot of plug in can help you stop spam comment. You will not"><meta property="og:type" content="article"><meta property="og:title" content="Protect your WordPress from Automated Comment Spam and Brute Force Login Attack"><meta property="og:url" content="https://www.qualityology.com/tech/stop-automated-comment-spam-brute-force-login-attack/index.html"><meta property="og:site_name" content="Qualityology - Let&#39;s get the most out of life!"><meta property="og:description" content="Is your WordPress flooded with spam comment or being attacked by brute force login attempt? Thinking about spam blocking plugin? There are a lot of plug in can help you stop spam comment. You will not"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2018-04-12T23:57:49.000Z"><meta property="article:modified_time" content="2021-02-24T04:02:34.058Z"><meta property="article:author" content="Evan Xu"><meta property="article:tag" content="WordPress"><meta property="article:tag" content="Apache"><meta property="article:tag" content="Nginx"><meta name="twitter:card" content="summary"><link rel="icon" type="image/png" href="/assets/logo.png"><link rel="apple-touch-icon" href="/assets/logo_160.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/logo_304.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/logo_360.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/logo_334.png"><meta name="apple-mobile-web-app-title" content="Protect your WordPress from Automated Comment Spam and Brute Force Login Attack - Qualityology - Let&#39;s get the most out of life!"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.9.2/css/bulma.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto&display=swap"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css"><link rel="stylesheet" href="/css/style.css"><script>const pageLoaded=()=>{const o=window.adsbygoogle||[];o.push({}),o.push({})}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-6144848-7"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-6144848-7")</script><meta name="generator" content="Hexo 5.4.0"></head><body onload="pageLoaded()"><nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item navbar-logo" href="/"><img src="/assets/loading.gif" data-original="/assets/logo.png" alt height="28"></a><div class="navbar-burger"><span></span> <span></span> <span></span></div></div><div class="navbar-menu navbar-start"><span class="navbar-item"><a href="/lifestyle">Lifestyle </a></span><span class="navbar-item is-active"><a href="/tech">Technology</a></span></div><div class="navbar-menu navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc"><a class="navbar-item" title="Table of Contents"><i class="fa fa-list"></i></a><div class="navbar-dropdown is-right"><a class="navbar-item" href="#Step-one-add-code-to-set-cookie">1&nbsp;&nbsp;<b>Step one, add code to set cookie.</b></a><hr class="navbar-divider"><a class="navbar-item" href="#Step-two-add-below-code-to-check-and-block-spam-bot-with-Nginx-Apache">2&nbsp;&nbsp;<b>Step two, add below code to check and block spam bot with Nginx/Apache</b></a><hr class="navbar-divider"><a class="navbar-item" href="#Step-three-reset-the-cookie-for-failed-login-attempt">3&nbsp;&nbsp;<b>Step three, reset the cookie for failed login attempt</b></a> <a class="navbar-item" href="#JavaScript-must-be-turned-on-and-browser-must-accept-cookie-for-this-system-to-work">3.1&nbsp;&nbsp;JavaScript must be turned on and browser must accept cookie for this system to work.</a></div></div></div></div></nav><section class="section"><div class="container"><article class="article content gallery" itemscope itemprop="blogPost"><h1 class="article-title is-size-4 is-size-4-mobile" itemprop="name">Protect your WordPress from Automated Comment Spam and Brute Force Login Attack</h1><div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile"><span class="column is-narrow"><time datetime="2018-04-12T23:57:49.000Z" itemprop="datePublished">Apr 12 2018</time> </span><span class="column is-narrow article-category"><i class="far fa-folder"></i> <a class="article-category-link" href="/tech/">tech</a> </span><span class="column is-narrow">4 minutes read (About 658 words)</span></div><div class="article-entry is-size-6-mobile" itemprop="articleBody"><p>Is your WordPress flooded with spam comment or being attacked by brute force login attempt? Thinking about spam blocking plugin? There are a lot of plug in can help you stop spam comment. You will notice it put thousands spam comments into spam folder after a while. Those Anti-Spam did a great job stopping spam comment show up in our post. There is some drawbacks for that kind of plugin. First,spam comments will be processed and store in your database before it gets deleted manually or automatically. Second, plugin like Akismet Anti-Spam will add a java-script to your site. If your site has limited resources, these kind of activities will drag down your site&#x2019;s performance. If you use captcha plugin, you will also interrupt user&#x2019;s experience.</p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6914615778368190" data-ad-slot="9746105168" data-ad-format="auto" data-full-width-responsive="true"></ins><p>If you are looking for a light way to block the spam bot before the comment get posted. Yes, we have one. We can block the spam bot and also protect your login page at the same time, Spam bots&#x2019; comments will not even reach the server. Unless you got hit with spam from real human. This method is almost perfect and very light to your server. It has no captcha, no moderation queues, no complicate settings page, and 99.99% filter rate. This idea is inspired by this <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.rtcx.net/stop-automated-comment-spam-wordpress">Stop Automated Comment Spam on WordPress with Nginx.</a> <strong>How this work?</strong> Most spam bot will not process contents from server, including js and cookies. Their job is to get the comment form and post. So we can use java-script and cookies to block spam bot when they try to post any word.</p><ul><li>When post is viewed, browser will set a small cookie named _pass into viewer&#x2019;s system.</li><li>If viewer attempted to post a comment, Nginx or Apache will check if they have that cookie in their system. Comment will go through if cookie found. Otherwise, it will shows 403 to block the access.</li><li>Since the cookie is set no matter viewer is attempt to leave comment or not, we can use the same cookie to prevent brute force login attack. Most spam bot and attack tools are not able to store cookie so the same theory work for both.</li></ul><p><strong>What you need?</strong></p><ul><li>Access to server&#x2019;s configuration file.&#xA0;(Nginx or Apache&#x2019;s config file)</li><li>Ability to change something.</li></ul><h2 id="Step-one-add-code-to-set-cookie"><a href="#Step-one-add-code-to-set-cookie" class="headerlink" title="Step one, add code to set cookie."></a>Step one, add code to set cookie.</h2><p>You can add below code via Code Snippets or directly to theme&#x2019;s function.php file. For HTTPS:</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function set_post_cookie() {</span><br><span class="line">echo &apos;&lt;script&gt;document.cookie = &quot;_pass=1; max-age=43200; path=/; secure&quot;;&lt;/script&gt;&apos; . &quot;n&quot;; </span><br><span class="line">}</span><br><span class="line">add_action( &apos;comment_form&apos;, &apos;set_post_cookie&apos;, 100 );</span><br></pre></td></tr></table></figure><p>This will set a cookie &#x201C;human&#x201D; and value is &#x201C;1&#x201D;. You can change the cookie name and value to whatever you want. If you use HTTP, remove the the work secure from above code.</p><h2 id="Step-two-add-below-code-to-check-and-block-spam-bot-with-Nginx-Apache"><a href="#Step-two-add-below-code-to-check-and-block-spam-bot-with-Nginx-Apache" class="headerlink" title="Step two, add below code to check and block spam bot with Nginx/Apache"></a>Step two, add below code to check and block spam bot with Nginx/Apache</h2><p><strong>For NGINX:</strong></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#Stop Automated Comment Spam and log in attempt with Nginx</span><br><span class="line">if ($request_uri ~* /wp.comments.post.php/wp-login.php) { set $block_flag 1; }</span><br><span class="line">if ($http_cookie ~* _pass) { set $block_flag 0; }</span><br><span class="line">if ($block_flag) {</span><br><span class="line">        return 403;</span><br><span class="line">    }</span><br></pre></td></tr></table></figure><p><strong>For Apache:</strong></p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RewriteCond %{REQUEST_URI} ^/wp.comments.post.php?$ [OR]</span><br><span class="line">RewriteCond %{REQUEST_URI} ^(.*)?wp-login\.php(.*)$</span><br><span class="line">RewriteCond %{HTTP_COOKIE} !_pass</span><br><span class="line">RewriteRule ^forbid/(.*)$ - [F]</span><br></pre></td></tr></table></figure><h2 id="Step-three-reset-the-cookie-for-failed-login-attempt"><a href="#Step-three-reset-the-cookie-for-failed-login-attempt" class="headerlink" title="Step three, reset the cookie for failed login attempt"></a>Step three, reset the cookie for failed login attempt</h2><p>Every time incorrect login attempted cookie will be remove to prevent brute force login attack. Add below codes to functions.php of your theme</p><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function no_wordpress_errors(){</span><br><span class="line">echo &apos;&lt;script&gt;document.cookie = &quot;_pass=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; secure&quot;;&lt;/script&gt;&apos; . &quot;&quot;;</span><br><span class="line">$ip=$_SERVER[&apos;REMOTE_ADDR&apos;];</span><br><span class="line">$message = &quot;Your are blocked. IP address $ip&quot;;</span><br><span class="line">return $message;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">add_filter( &apos;login_errors&apos;, &apos;no_wordpress_errors&apos;);</span><br></pre></td></tr></table></figure><h3 id="JavaScript-must-be-turned-on-and-browser-must-accept-cookie-for-this-system-to-work"><a href="#JavaScript-must-be-turned-on-and-browser-must-accept-cookie-for-this-system-to-work" class="headerlink" title="JavaScript must be turned on and browser must accept cookie for this system to work."></a>JavaScript must be turned on and browser must accept cookie for this system to work.</h3><p>Remember! Next time when you try to login your admin page, open a post first so you will have the cookie and will not be blocked by this.</p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6914615778368190" data-ad-slot="2953513567" data-ad-format="auto" data-full-width-responsive="true"></ins></div><div class="columns is-variable is-1 is-multiline is-mobile"><span class="column is-narrow"><a class="tag is-light article-tag" href="/tag/wordpress/">#WordPress</a></span> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tag/apache/">#Apache</a></span> <span class="column is-narrow"><a class="tag is-light article-tag" href="/tag/nginx/">#Nginx</a></span></div><div class="columns is-mobile is-multiline article-nav"><span class="column is-12-mobile is-half-desktop article-nav-prev"><a href="/tech/set-custom-dns-server-on-linux-resolv-conf/">Set custom DNS servers on Linux with resolv.conf</a> </span><span class="column is-12-mobile is-half-desktop article-nav-next"><a href="/tech/asus-z87-macos-high-sierra-upgrade-guide-clover/">Asus Z87-A MacOS high sierra upgrade prepare with clover</a></span></div></article><div class="sharebox"><div class="sharethis-inline-share-buttons"></div><script async type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=6030430e289b2f0011212bb6&amp;product=sop"></script></div><div class="comments"><h3 class="title is-4">Comments</h3><div id="isso-thread" data-title="Protect your WordPress from Automated Comment Spam and Brute Force Login Attack"></div><script async data-isso="//comments.qualityology.com" src="//comments.qualityology.com/js/embed.min.js" data-isso-require-author="true" data-isso-require-email="true" data-isso-avatar="false" data-isso-gravatar="true" data-isso-vote="true" data-isso-reveal-on-click="true"></script></div></div></section><footer class="footer"><div class="container"><div class="columns content"><div class="column is-narrow has-text-centered">&copy; 2021 Qualityology&nbsp;</div><div class="column is-hidden-mobile"></div></div></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/js/all.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>window.FontAwesomeConfig={searchPseudoElements:!0},moment.locale("en-AU")</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><style>.hljs{position:relative}.hljs .clipboard-btn{float:right;color:#9a9a9a;background:0 0;border:none;cursor:pointer}.hljs .clipboard-btn:hover{color:#8a8a8a}.hljs>.clipboard-btn{display:none;position:absolute;right:4px;top:4px}.hljs:hover>.clipboard-btn{display:inline}.hljs>figcaption>.clipboard-btn{margin-right:4px}</style><script>$(document).ready(function(){$("figure.hljs").each(function(t,e){var a="code-"+t,r=e.querySelector(".code"),t=$('<button>Copy <i class="far fa-clipboard"></i></button>');r.id=a,t.addClass("clipboard-btn"),t.attr("data-clipboard-target-id",a);a=e.querySelector("figcaption");a?a.append(t[0]):e.prepend(t[0])}),new ClipboardJS(".clipboard-btn",{target:function(t){return document.getElementById(t.getAttribute("data-clipboard-target-id"))}}).on("success",function(t){t.clearSelection()})})</script><script src="/js/script.js"></script><div class="searchbox ins-search"><div class="searchbox-mask"></div><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 3,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>