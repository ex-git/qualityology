<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>Qualityology - Let&#39;s get the most out of life! â€¢ Posts by &#34;nginx&#34; tag</title>
        <link>https://www.qualityology.com</link>
        <description>To uncover the best way to achieve desired level of quality in everything. - We dive deep on adding quality to tech gadgets, business, and entertainment because quality matter in life.</description>
        <language>en</language>
        <pubDate>Thu, 12 Apr 2018 16:57:49 -0700</pubDate>
        <lastBuildDate>Thu, 12 Apr 2018 16:57:49 -0700</lastBuildDate>
        <category term="tech" />
        <category term="lifestyle" />
        <item>
            <guid isPermalink="true">https://www.qualityology.com/tech/stop-automated-comment-spam-brute-force-login-attack/</guid>
            <title>Protect your WordPress from Automated Comment Spam and Brute Force Login Attack</title>
            <link>https://www.qualityology.com/tech/stop-automated-comment-spam-brute-force-login-attack/</link>
            <category>tech</category>
            <pubDate>Thu, 12 Apr 2018 16:57:49 -0700</pubDate>
            <description><![CDATA[ &lt;p&gt;Is your WordPress flooded with spam comment or being attacked by brute force login attempt? Thinking about spam blocking plugin? There are a lot of plug in can help you stop spam comment. You will notice it put thousands spam comments into spam folder after a while. Those Anti-Spam did a great job stopping spam comment show up in our post. There is some drawbacks for that kind of plugin. First,spam comments will be processed and store in your database before it gets deleted manually or automatically. Second, plugin like Akismet Anti-Spam will add a java-script to your site. If your site has limited resources, these kind of activities will drag down your site&amp;#x2019;s performance. If you use captcha plugin, you will also interrupt user&amp;#x2019;s experience.&lt;/p&gt;
&lt;p&gt;If you are looking for a light way to block the spam bot before the comment get posted. Yes, we have one. We can block the spam bot and also protect your login page at the same time, Spam bots&amp;#x2019; comments will not even reach the server. Unless you got hit with spam from real human. This method is almost perfect and very light to your server. It has no captcha, no moderation queues, no complicate settings page, and 99.99% filter rate. This idea is inspired by this &lt;a href=&#34;https://www.rtcx.net/stop-automated-comment-spam-wordpress&#34;&gt;Stop Automated Comment Spam on WordPress with Nginx.&lt;/a&gt; &lt;strong&gt;How this work?&lt;/strong&gt; Most spam bot will not process contents from server, including js and cookies. Their job is to get the comment form and post. So we can use java-script and cookies to block spam bot when they try to post any word.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;  When post is viewed, browser will set a small cookie named _pass into viewer&amp;#x2019;s system.&lt;/li&gt;
&lt;li&gt;  If viewer attempted to post a comment, Nginx or Apache will check if they have that cookie in their system. Comment will go through if cookie found. Otherwise, it will shows 403 to block the access.&lt;/li&gt;
&lt;li&gt;  Since the cookie is set no matter viewer is attempt to leave comment or not, we can use the same cookie to prevent brute force login attack. Most spam bot and attack tools are not able to store cookie so the same theory work for both.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;What you need?&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;  Access to server&amp;#x2019;s configuration file.&amp;#xA0;(Nginx or Apache&amp;#x2019;s config file)&lt;/li&gt;
&lt;li&gt;  Ability to change something.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;Step-one-add-code-to-set-cookie&#34;&gt;&lt;a href=&#34;#Step-one-add-code-to-set-cookie&#34; class=&#34;headerlink&#34; title=&#34;Step one, add code to set cookie.&#34;&gt;&lt;/a&gt;Step one, add code to set cookie.&lt;/h2&gt;&lt;p&gt;You can add below code via Code Snippets or directly to theme&amp;#x2019;s function.php file. For HTTPS:&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;function set_post_cookie() {&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;echo &amp;apos;&amp;lt;script&amp;gt;document.cookie = &amp;quot;_pass=1; max-age=43200; path=/; secure&amp;quot;;&amp;lt;/script&amp;gt;&amp;apos; . &amp;quot;n&amp;quot;; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;add_action( &amp;apos;comment_form&amp;apos;, &amp;apos;set_post_cookie&amp;apos;, 100 );&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;This will set a cookie &amp;#x201C;human&amp;#x201D; and value is &amp;#x201C;1&amp;#x201D;. You can change the cookie name and value to whatever you want. If you use HTTP, remove the the work secure from above code.&lt;/p&gt;
&lt;h2 id=&#34;Step-two-add-below-code-to-check-and-block-spam-bot-with-Nginx-Apache&#34;&gt;&lt;a href=&#34;#Step-two-add-below-code-to-check-and-block-spam-bot-with-Nginx-Apache&#34; class=&#34;headerlink&#34; title=&#34;Step two, add below code to check and block spam bot with Nginx/Apache&#34;&gt;&lt;/a&gt;Step two, add below code to check and block spam bot with Nginx/Apache&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;For NGINX:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#Stop Automated Comment Spam and log in attempt with Nginx&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;if ($request_uri ~* /wp.comments.post.php/wp-login.php) { set $block_flag 1; }&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;if ($http_cookie ~* _pass) { set $block_flag 0; }&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;if ($block_flag) {&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        return 403;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;For Apache:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;RewriteCond %{REQUEST_URI} ^/wp.comments.post.php?$ [OR]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RewriteCond %{REQUEST_URI} ^(.*)?wp-login\.php(.*)$&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RewriteCond %{HTTP_COOKIE} !_pass&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RewriteRule ^forbid/(.*)$ - [F]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;Step-three-reset-the-cookie-for-failed-login-attempt&#34;&gt;&lt;a href=&#34;#Step-three-reset-the-cookie-for-failed-login-attempt&#34; class=&#34;headerlink&#34; title=&#34;Step three, reset the cookie for failed login attempt&#34;&gt;&lt;/a&gt;Step three, reset the cookie for failed login attempt&lt;/h2&gt;&lt;p&gt;Every time incorrect login attempted cookie will be remove to prevent brute force login attack. Add below codes to functions.php of your theme&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;function no_wordpress_errors(){&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;echo &amp;apos;&amp;lt;script&amp;gt;document.cookie = &amp;quot;_pass=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; secure&amp;quot;;&amp;lt;/script&amp;gt;&amp;apos; . &amp;quot;&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$ip=$_SERVER[&amp;apos;REMOTE_ADDR&amp;apos;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$message = &amp;quot;Your are blocked. IP address $ip&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;return $message;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;add_filter( &amp;apos;login_errors&amp;apos;, &amp;apos;no_wordpress_errors&amp;apos;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&#34;JavaScript-must-be-turned-on-and-browser-must-accept-cookie-for-this-system-to-work&#34;&gt;&lt;a href=&#34;#JavaScript-must-be-turned-on-and-browser-must-accept-cookie-for-this-system-to-work&#34; class=&#34;headerlink&#34; title=&#34;JavaScript must be turned on and browser must accept cookie for this system to work.&#34;&gt;&lt;/a&gt;JavaScript must be turned on and browser must accept cookie for this system to work.&lt;/h3&gt;&lt;p&gt;Remember! Next time when you try to login your admin page, open a post first so you will have the cookie and will not be blocked by this.&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://www.qualityology.com/tech/build-extremely-fast-wordpress-gcp-part-2-nginx/</guid>
            <title>Build an extremely fast WordPress with GCP Part 2: Nginx</title>
            <link>https://www.qualityology.com/tech/build-extremely-fast-wordpress-gcp-part-2-nginx/</link>
            <category>tech</category>
            <pubDate>Sat, 30 Sep 2017 22:11:32 -0700</pubDate>
            <description><![CDATA[ &lt;p&gt;Apache or Nginx, what softwares should be used to for your server to achieve the maximum performance? If you have a small free server from GCP from &lt;a href=&#34;https://www.qualityology.com/tech/build-an-extremely-fast-wordpress-gcp-part1-server/&#34;&gt;part 1&lt;/a&gt;, and you want it to be able to handle average 1000 clients per second, Nginx is the best option. Apache use more server resources and must be configured properly to get the best performance. Nginx can handle very large amount of traffic even in a limited environment. We have done the loading test with the server from Google Cloud Platform from &lt;a href=&#34;https://www.qualityology.com/tech/build-an-extremely-fast-wordpress-gcp-part1-server/&#34;&gt;part 1&lt;/a&gt;&amp;#xA0;and the result was great without deep optimization. 1000 client/sec is not the maximum that this setup can get, it is the limit of the free test we could get. &lt;img src=&#34;/2017/09/loading-test-result.png&#34;&gt; When we tried the same test using Apache, the test was aborted at the beginning because server crashed. That is why we will use Nginx. We are not the server expert, so we will not discuss how to optimize Apache to pass the same test. What we will need is NGINX + MySQL + PHP-FPM +&amp;#xA0;Microcaching + WordPress.&lt;/p&gt;
&lt;h2 id=&#34;Step-1-install-Nginx&#34;&gt;&lt;a href=&#34;#Step-1-install-Nginx&#34; class=&#34;headerlink&#34; title=&#34;Step 1, install Nginx.&#34;&gt;&lt;/a&gt;Step 1, install Nginx.&lt;/h2&gt;&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get update -y&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get install nginx -y&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo service nginx start&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;Step-2-install-Mysql-or-MariaDB&#34;&gt;&lt;a href=&#34;#Step-2-install-Mysql-or-MariaDB&#34; class=&#34;headerlink&#34; title=&#34;Step 2, install Mysql (or MariaDB).&#34;&gt;&lt;/a&gt;Step 2, install Mysql (or MariaDB).&lt;/h2&gt;&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get install mysql-server -y&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo service mysql stop&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo mysql_install_db # follow instructions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo service mysql start&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo mysql_secure_installation # follow instructions&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;Step-3-install-Install-PHP-FPM&#34;&gt;&lt;a href=&#34;#Step-3-install-Install-PHP-FPM&#34; class=&#34;headerlink&#34; title=&#34;Step 3, install Install PHP-FPM&#34;&gt;&lt;/a&gt;Step 3, install Install PHP-FPM&lt;/h2&gt;&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo apt-get install php-fpm php-mysql php-gd php-cli php-xml php-mbstring&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Add cgi.fix_pathinfo=0 to php.ini, if you know how to add, jump to step 4, otherwise, continue below.&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# if you use different version of PHP, change 7.0 to your version e.g. 8.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo nano /etc/php/7.0/fpm/php.ini&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# paste cgi.fix_pathinfo=0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# press ctrl + X key, and type Y to save the file.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# restart PHP-FPM service&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# if you use different version of PHP, change the 7.0 accordingly&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo service php7.0-fpm restart&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;Step-4-configure-Nginx-to-use-PHP-FPM-to-process-php-files&#34;&gt;&lt;a href=&#34;#Step-4-configure-Nginx-to-use-PHP-FPM-to-process-php-files&#34; class=&#34;headerlink&#34; title=&#34;Step 4, configure Nginx to use PHP-FPM to process php files&#34;&gt;&lt;/a&gt;Step 4, configure Nginx to use PHP-FPM to process php files&lt;/h2&gt;&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo nano /etc/nginx/sites-available/default&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;# add the following to the server { } block&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                location ~ \.php$ {&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                try_files $uri =404;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                fastcgi_split_path_info ^(.+\.php)(/.+)$;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                fastcgi_index index.php;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                include fastcgi_params;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        }&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Restart Nginx&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo service nginx restart&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;Step-5-add-Microcaching-to-Nginx&#34;&gt;&lt;a href=&#34;#Step-5-add-Microcaching-to-Nginx&#34; class=&#34;headerlink&#34; title=&#34;Step 5, add Microcaching to Nginx&#34;&gt;&lt;/a&gt;Step 5, add Microcaching to Nginx&lt;/h2&gt;&lt;p&gt;With Microcaching, Nginx can handle large amount of traffic because dynamic inquiries/files are cached to prevent overloading your database. For example if each client to your website generate 2 database inquiry, 1000 client will have 2000 inquires. If you set up cache for 5 seconds, 1000 clients within 5 seconds will only hit your database 2 times if both inquires are cached. That is the magic of this setup.&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# always backup the file you want to change&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo nano /etc/nginx/sites-available/default&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Add the following to the file. You can add this before the server {} block&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;# Microcaching&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache_path /var/run/nginx-cache levels=1:2 keys_zone=qualityology-com:100m inactive=60m;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache_key &amp;quot;$scheme$request_method$host$request_uri&amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Add the following to location ~ \.php$ {} block. Below configuration will set the cache to expire after 10 seconds, and no cache for logged in users and commenters. You can change the 10s to longer time, but 10s is long enough for your need.&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#Cache everything by default&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;set $no_cache 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#Don&amp;apos;t cache logged in users or commenters&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;if ( $http_cookie ~* &amp;quot;comment_author_wordpress_(?!test_cookie)wp-postpass_&amp;quot; ) {&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        set $no_cache 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#Don&amp;apos;t cache the following URLs&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;if ($request_uri ~* &amp;quot;/(wp-admin/wp-login.php)&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;{&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        set $no_cache 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;}&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#matches keys_zone in fastcgi_cache_path&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache qualityology-com;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#don&amp;apos;t serve pages defined earlier&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache_bypass $no_cache;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#don&amp;apos;t cache pages defined earlier&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_no_cache $no_cache;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#defines the default cache time&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache_valid any 10s;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#unsure what the impacts of this variable is&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_max_temp_file_size 2M;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#Use stale cache items while updating in the background&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache_use_stale updating error timeout invalid_header http_500;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache_lock on;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fastcgi_cache_lock_timeout 10s;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;Test if your configuration&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo nginx -t&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;If no error, reload your Nginx or restart it&lt;/p&gt;
&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo service nginx start&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h2 id=&#34;Step-6-install-WordPress&#34;&gt;&lt;a href=&#34;#Step-6-install-WordPress&#34; class=&#34;headerlink&#34; title=&#34;Step 6, install WordPress&#34;&gt;&lt;/a&gt;Step 6, install WordPress&lt;/h2&gt;&lt;figure class=&#34;highlight plain hljs&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;cd /var/www/html/&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo wget http://wordpress.org/latest.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo tar xzvf latest.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo rm latest.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo mv wordpress/* ./&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sudo chown -R www-data:www-data /var/www/html/*&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;You are all set. Now, open your domain or IP to setup WordPress&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://www.qualityology.com/tech/build-an-extremely-fast-wordpress-gcp-part1-server/</guid>
            <title>Build an extremely fast WordPress with GCP Part 1: server</title>
            <link>https://www.qualityology.com/tech/build-an-extremely-fast-wordpress-gcp-part1-server/</link>
            <category>tech</category>
            <pubDate>Sun, 17 Sep 2017 21:16:14 -0700</pubDate>
            <description><![CDATA[ &lt;p&gt;Can you get a super fast server free from Google? Yes, you can. Google Cloud Platform has free tier for US region server. If you are building a small WordPress website using light bandwidth, the free tier is more than sufficient. Free tier provide 720 hours of instance usage which will cover whole month of usage. The only downside is if your site use a lot of bandwidth you will be billed after 1GB of free egress bandwidth, but still cheap because 1 GB cost only&amp;#xA0;$0.01 for US and 1 TB $0.12 - $0.23 depends on the regions. Most new sites use only small amount of bandwidth. Ingress is free if you wonder. As of today, the free tier offer:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;  1 f1-micro instance per month (US regions only - Excluding Northern Virginia)&lt;/li&gt;
&lt;li&gt;  30 GB-months HDD, 5 GB-months snapshot&lt;/li&gt;
&lt;li&gt;  1 GB network egress from North America to all region destinations per month (excluding China and Australia)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;Step-1-update-your-billing-info&#34;&gt;&lt;a href=&#34;#Step-1-update-your-billing-info&#34; class=&#34;headerlink&#34; title=&#34;Step 1, update your billing info.&#34;&gt;&lt;/a&gt;Step 1, update your billing info.&lt;/h2&gt;&lt;p&gt;Open &lt;a href=&#34;https://console.cloud.google.com/billing&#34;&gt;https://console.cloud.google.com/billing&lt;/a&gt;, update your billing info. You may be requested to create a project name.&lt;/p&gt;
&lt;h2 id=&#34;Step-2-create-your-virtual-server-instance&#34;&gt;&lt;a href=&#34;#Step-2-create-your-virtual-server-instance&#34; class=&#34;headerlink&#34; title=&#34;Step 2, create your virtual server (instance)&#34;&gt;&lt;/a&gt;Step 2, create your virtual server (instance)&lt;/h2&gt;&lt;p&gt;Open &lt;a href=&#34;https://console.cloud.google.com/compute&#34;&gt;https://console.cloud.google.com/compute&lt;/a&gt; and click CREATE INSTANCE. &lt;img src=&#34;/2017/09/create_instance.png&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;Step-3-configure-your-server&#34;&gt;&lt;a href=&#34;#Step-3-configure-your-server&#34; class=&#34;headerlink&#34; title=&#34;Step 3, configure&amp;#xA0;your server.&#34;&gt;&lt;/a&gt;Step 3, configure&amp;#xA0;your server.&lt;/h2&gt;&lt;p&gt;Match the free tier configuration, do not click create&amp;#xA0;yet after this step.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;  &lt;strong&gt;Zone&lt;/strong&gt;: pick a US region. eg: us-west1-a&lt;/li&gt;
&lt;li&gt;  &lt;strong&gt;Machine type&lt;/strong&gt;: micro (1 shared vCPU, 0.6 GB memory, f1-micro)&lt;/li&gt;
&lt;li&gt;  &lt;strong&gt;Boot disk&lt;/strong&gt;: 30 GB standard persistent disk. SSD is not free!&lt;/li&gt;
&lt;li&gt;  &lt;strong&gt;OS images&lt;/strong&gt;: pick one of your favor, or use&amp;#xA0;Debian GNU/Linux 9 (stretch) as what we picked.&lt;/li&gt;
&lt;li&gt;  &lt;strong&gt;Firewall&lt;/strong&gt;: check Allow HTTP traffic and Allow HTTPS traffic&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;Step-4-get-an-static-IP-for-your-instance&#34;&gt;&lt;a href=&#34;#Step-4-get-an-static-IP-for-your-instance&#34; class=&#34;headerlink&#34; title=&#34;Step 4: get an static IP for your instance.&#34;&gt;&lt;/a&gt;Step 4: get an static IP for your instance.&lt;/h2&gt;&lt;p&gt;Expand&amp;#xA0;Management, disks, networking, SSH keys &lt;img src=&#34;https://www.qualityology.com/2017/09/instance_config_micro.png&#34;&gt; Under Networking &amp;gt;&amp;gt; Network interfaces &amp;gt;&amp;gt; External IP, select Create IP address &lt;img src=&#34;/2017/09/instance_static_ip.png&#34;&gt; After you reserve an static external IP address, you can click Create to finish the instance setup. You have complete the step 1 and you have your&amp;#xA0;free server from GCP, continue to &lt;a href=&#34;https://www.qualityology.com/tech/build-extremely-fast-wordpress-gcp-part-2-nginx/&#34;&gt;part 2&lt;/a&gt; when you ready.&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>