{
    "version": "https://jsonfeed.org/version/1",
    "title": "Qualityology - Let's get the most out of life! â€¢ All posts by \"react\" tag",
    "description": "To uncover the best way to achieve desired level of quality in everything. - We dive deep on adding quality to tech gadgets, business, and entertainment because quality matter in life.",
    "home_page_url": "https://www.qualityology.com",
    "items": [
        {
            "id": "https://www.qualityology.com/tech/connect-to-existing-aws-appsync-api-from-a-react-application/",
            "url": "https://www.qualityology.com/tech/connect-to-existing-aws-appsync-api-from-a-react-application/",
            "title": "Connect to existing AWS AppSync API from a React Application",
            "date_published": "2021-02-27T04:53:22.000Z",
            "content_html": "<p>Have an existing API within AWS AppSync and need to connect it from a React web application? If you are not completely new to GraphQL you should know that the most popular GraphQL client is Apollo. </p>\n<p>There are many different way to connect to AWS AppSync with React, using different packages. Some required more packages/dependencies. </p>\n<p><img src=\"/2021/aws_appsync.jpeg\" alt=\"aws_appsync\"></p>\n<h2 id=\"1-Use-Apollo-client\"><a href=\"#1-Use-Apollo-client\" class=\"headerlink\" title=\"1. Use Apollo client\"></a>1. Use Apollo client</h2><p>The latest version <code>@apollo/client</code> can handle AWS AppSync&#x2019;s query and mutation just fine with simple setup and also support React hook out of the box. Per their official doc, they will only support <code>useQuery</code> for query and <code>useMutation</code> for mutation hooks in their future release. Component based query and mutation will still work but will not be supported. However, for subscription, <code>@apollo/client</code> and AWS AppSync API won&#x2019;t work without complex setup because AppSync&#x2019;s subscriptions use MQTT as the transport layer, but <code>@apollo/client</code> support WebSockets.</p>\n<p>If you are using React with version that support hook, and you don&#x2019;t have the need for subscription, this option will work very well.</p>\n<ol>\n<li>Install required package<br><code>yarn add @apollo/client aws-appsync-auth-link</code></li>\n<li>Create client.js with following setup. <code>aws-exports</code> is the config download from your AWS AppSync API</li>\n</ol>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">import</span> {</span><br><span class=\"line\">    ApolloClient, ApolloLink, InMemoryCache, createHttpLink,</span><br><span class=\"line\">} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;@apollo/client&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> { createAuthLink } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;aws-appsync-auth-link&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> AppSyncConfig <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./aws-exports&apos;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> url = AppSyncConfig.aws_appsync_graphqlEndpoint;</span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> region = AppSyncConfig.aws_project_region;</span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> auth = {</span><br><span class=\"line\">    type: AppSyncConfig.aws_appsync_authenticationType,</span><br><span class=\"line\">    apiKey: AppSyncConfig.aws_appsync_apiKey,</span><br><span class=\"line\">};</span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> link = ApolloLink.from([</span><br><span class=\"line\">    <span class=\"hljs-comment\">// @ts-ignore</span></span><br><span class=\"line\">    createAuthLink({ url, region, auth }),</span><br><span class=\"line\">    <span class=\"hljs-comment\">// @ts-ignore</span></span><br><span class=\"line\">    createHttpLink({ <span class=\"hljs-attr\">uri</span>: url }),</span><br><span class=\"line\">]);</span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> client = <span class=\"hljs-keyword\">new</span> ApolloClient({</span><br><span class=\"line\">    link,</span><br><span class=\"line\">    cache: <span class=\"hljs-keyword\">new</span> InMemoryCache(),</span><br><span class=\"line\">});</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> client;</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>In your <code>index.js</code> add below code to Apollo client accessible.<br><code>ApolloProvider</code> will make your AppSync client accessable any child of the entry point component whic is App in this example.</li>\n</ol>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">import</span> { ApolloProvider } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;@apollo/client&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> client <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./graphQL/client&apos;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;ApolloProvider client={client}&gt;</span><br><span class=\"line\">&lt;App /&gt;</span><br><span class=\"line\">&lt;/ApolloProvider&gt;</span><br></pre></td></tr></table></figure>\n<p>Example of making a mutation call:</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">import</span> {</span><br><span class=\"line\">\tuseMutation,</span><br><span class=\"line\">  gql</span><br><span class=\"line\">} <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;@apollo/client&apos;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> createTodo = gql<span class=\"hljs-string\">`</span></span><br><span class=\"line\"><span class=\"hljs-string\">  mutation CreateTodo(</span></span><br><span class=\"line\"><span class=\"hljs-string\">      item: String!</span></span><br><span class=\"line\"><span class=\"hljs-string\">    ) {</span></span><br><span class=\"line\"><span class=\"hljs-string\">    createUpdateMonitor(input: {</span></span><br><span class=\"line\"><span class=\"hljs-string\">      item: item</span></span><br><span class=\"line\"><span class=\"hljs-string\">    }) {</span></span><br><span class=\"line\"><span class=\"hljs-string\">        item</span></span><br><span class=\"line\"><span class=\"hljs-string\">    }</span></span><br><span class=\"line\"><span class=\"hljs-string\">  }</span></span><br><span class=\"line\"><span class=\"hljs-string\">`</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> [createTodoMutation] = useMutation(createTodo);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> handleCreateTodoClick = <span class=\"hljs-function\">() =&gt;</span> {</span><br><span class=\"line\">        <span class=\"hljs-keyword\">const</span> todo = {</span><br><span class=\"line\">          item: <span class=\"hljs-string\">&apos;visit qualityology.com&apos;</span></span><br><span class=\"line\">        }</span><br><span class=\"line\">        createTodoMutation({</span><br><span class=\"line\">            variables: todo,</span><br><span class=\"line\">        })</span><br><span class=\"line\">            .then(<span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>) =&gt;</span> <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&apos;Todo created successfully&apos;</span>))</span><br><span class=\"line\">            .catch(<span class=\"hljs-function\">(<span class=\"hljs-params\">err</span>) =&gt;</span> {</span><br><span class=\"line\">                <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&apos;Error occurred&apos;</span>);</span><br><span class=\"line\">                <span class=\"hljs-built_in\">console</span>.log(err);</span><br><span class=\"line\">            });</span><br><span class=\"line\">    };</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"2-Use-AWS-AppSync-JavaScript-SDK\"><a href=\"#2-Use-AWS-AppSync-JavaScript-SDK\" class=\"headerlink\" title=\"2. Use AWS AppSync JavaScript SDK\"></a>2. Use AWS AppSync JavaScript SDK</h2><p>This SDK can be used with <code>apollo-client</code> and it is the offical SDK provided by AWS Labs. It support offline feature and also work with class components. Your <code>index.js</code> will need to be setup with the following code. You will need to download <code>aws-exports.js</code> from your AWS AppSync API and install <code>react-apollo aws-appsync-react</code> for this setup. ``aws-exports.js` contains the GraphQL endpoint url and your AWS AppSync API region, auth type info. </p>\n<p><code>new AWSAppSyncClient</code> will create a new AppSync client and store it in the <code>client</code> variable.<br><code>ApolloProvider</code> will make your AppSync client accessible any child of the entry point component whic is App in this example.</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">import</span> AWSAppSyncClient <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;aws-appsync&apos;</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> React <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;react&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> ReactDOM <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;react-dom&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> AppSyncConfig <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./aws-exports&apos;</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> { ApolloProvider } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;react-apollo&apos;</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> { Rehydrated } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;aws-appsync-react&apos;</span> <span class=\"hljs-comment\">// this needs to also be installed when working with React</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> App <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./App&apos;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> client = <span class=\"hljs-keyword\">new</span> AWSAppSyncClient({</span><br><span class=\"line\">  url: AppSyncConfig.graphqlEndpoint,</span><br><span class=\"line\">  region: AppSyncConfig.region,</span><br><span class=\"line\">  auth: {</span><br><span class=\"line\">    type: AppSyncConfig.authenticationType,</span><br><span class=\"line\">    apiKey: AppSyncConfig.apiKey,</span><br><span class=\"line\">    <span class=\"hljs-comment\">// jwtToken: async () =&gt; token, // Required when you use Cognito UserPools OR OpenID Connect. token object is obtained previously</span></span><br><span class=\"line\">  }</span><br><span class=\"line\">})</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> WithProvider = <span class=\"hljs-function\">() =&gt;</span> (</span><br><span class=\"line\">  &lt;ApolloProvider client={client}&gt;</span><br><span class=\"line\">    &lt;Rehydrated&gt;</span><br><span class=\"line\">      &lt;App /&gt;</span><br><span class=\"line\">    &lt;/Rehydrated&gt;</span><br><span class=\"line\">  &lt;/ApolloProvider&gt;</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">ReactDOM.render(<span class=\"hljs-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">WithProvider</span> /&gt;</span></span>, <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&apos;root&apos;</span>));</span><br></pre></td></tr></table></figure>\n<p><code>Rehydrate</code> will make sure application cache has been read and is ready to use before rendering the app. If app is not ready, it will show the default <code>loading</code> text. If you want to confured the display text, you can call the render function as below.</p>\n<figure class=\"highlight jsx hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;Rehydrated</span><br><span class=\"line\">  render={<span class=\"hljs-function\">(<span class=\"hljs-params\">{ rehydrated }</span>) =&gt;</span> (</span><br><span class=\"line\">    rehydrated ? <span class=\"hljs-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">App</span> /&gt;</span></span> : <span class=\"hljs-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span>&gt;</span>Fancy loading function here!<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span></span><br><span class=\"line\">  )}</span><br><span class=\"line\"> /&gt;</span><br></pre></td></tr></table></figure>\n<p>This method didn&#x2019;t work with out test application because it always show loading so it is not recommended to use unless you want to try it with a good reason. You can get more configuration from the project page <a href=\"https://github.com/awslabs/aws-mobile-appsync-sdk-js\">here</a>. </p>\n<h2 id=\"3-Use-AWS-Amplify\"><a href=\"#3-Use-AWS-Amplify\" class=\"headerlink\" title=\"3. Use AWS Amplify\"></a>3. Use AWS Amplify</h2><p>This is the easiest and with complete support of query, mutation, and subscription for AWS AppSync API. You will need your AWS AppSync API ID and the config export for this method. It can be found in AWS console.</p>\n<ol>\n<li><p>Install AWS Amplify cli. </p>\n<p><code>npm install -g @aws-amplify/cli</code></p>\n<p>The cli is needed for importing API</p>\n</li>\n<li><p>Navigate to your React project root folder.<br><code>amplify init</code></p>\n</li>\n<li><p>Add the codegen category to your React project.<br> `amplify add codegen &#x2013;apiId YOUR_API_ID_HERE</p>\n</li>\n<li><p>Generate client code.<br><code>amplify codegen</code><br>Follow the steps in your terminal. </p>\n</li>\n<li><p>Add <code>aws-amplify</code><br> <code>npm install aws-amplify</code> or  <code>yarn add aws-amplify</code></p>\n</li>\n<li><p>Add below code to your React application root <code>index.js</code></p>\n</li>\n</ol>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">import</span> { Amplify } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;aws-amplify&apos;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// some imports here</span></span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> { Amplify } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;aws-amplify&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> amplifyConfig <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;./aws-exports&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-comment\">// after all the imports</span></span><br><span class=\"line\"></span><br><span class=\"line\">Amplify.configure(amplifyConfig);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-comment\">// the rest of the code, ReactDOM etc.</span></span><br></pre></td></tr></table></figure>\n<p>Example of how the function used to call mutation look like:</p>\n<figure class=\"highlight js hljs\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"hljs-keyword\">import</span> { API, graphqlOperation } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;aws-amplify&apos;</span>;</span><br><span class=\"line\"><span class=\"hljs-keyword\">import</span> { createTodo } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&apos;/graphql/mutations&apos;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> todo = {</span><br><span class=\"line\">\titem: <span class=\"hljs-string\">&apos;visit qualityology.com&apos;</span></span><br><span class=\"line\">}</span><br><span class=\"line\"><span class=\"hljs-keyword\">const</span> update = <span class=\"hljs-keyword\">await</span> API.graphql(</span><br><span class=\"line\">            graphqlOperation(</span><br><span class=\"line\">                createTodo,</span><br><span class=\"line\">                {</span><br><span class=\"line\">                    input: todo,</span><br><span class=\"line\">                },</span><br><span class=\"line\">            ),</span><br><span class=\"line\">        )</span><br><span class=\"line\">        .then(<span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>) =&gt;</span> res)</span><br><span class=\"line\">        .catch(<span class=\"hljs-function\">(<span class=\"hljs-params\">error</span>) =&gt;</span> <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&apos;error, creating user&apos;</span>, error));</span><br><span class=\"line\"><span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&apos;update&apos;</span>, update);</span><br></pre></td></tr></table></figure>\n\n\n\n\n",
            "tags": [
                "Server",
                "React",
                "API"
            ]
        }
    ]
}